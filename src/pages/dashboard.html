<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Valorant Analytics ‚Äì Admin</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; margin-bottom: 40px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    th { background: #eee; }
    td[contenteditable] { background: #fdfdfd; }
    button { cursor: pointer; }
  </style>
</head>
<body>

<h1>Valorant Analytics ‚Äì Admin</h1>

<!-- PLAYERS -->
<h2>Players</h2>
<table id="playersTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nom</th>
      <th>Status</th>
      <th>R√¥le</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function loadPlayers() {
  const res = await fetch("../api/getAll.php");
  const data = await res.json();

  const tbody = document.querySelector("#playersTable tbody");
  tbody.innerHTML = "";

  data.players.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.player_id}</td>
      <td contenteditable data-field="player_name">${p.player_name}</td>
      <td contenteditable data-field="status">${p.status}</td>
      <td contenteditable data-field="role">${p.role ?? ""}</td>
      <td>
        <button onclick="saveRow('players','player_id',${p.player_id}, this)">üíæ</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function saveRow(table, idColumn, idValue, btn) {
  const row = btn.closest("tr");
  const fields = row.querySelectorAll("[data-field]");
  const payload = {};

  fields.forEach(f => {
    payload[f.dataset.field] = f.innerText.trim();
  });

  const res = await fetch("../api/update.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      table,
      idColumn,
      idValue,
      data: payload
    })
  });

  const result = await res.json();

  if (result.error) {
    alert("‚ùå Erreur sauvegarde");
    console.error(result);
  } else {
    alert("‚úî Sauvegard√©");
  }
}

loadPlayers();
</script>

</body>
</html>
